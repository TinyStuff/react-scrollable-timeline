import*as e from"react";import{createElement as t}from"react";const i=(e,t)=>e.start.getTime()-t.start.getTime(),r=(e,{startTime:t,ratio:i})=>{const r=e.start.getTime()-t,s=e.end.getTime()-t,a=Math.round(r*i);return{width:Math.round(s*i)-a,left:a}},{useRef:s,useEffect:a}=e,{format:n,isToday:l,isPast:o,addDays:d,startOfDay:c}=require("date-fns"),m=({evt:e})=>t("div",{key:e.id,className:"react-scrollable-timeline-event"},e.title?e.title:e.id),h=({group:e,maxHeight:i,resourceNode:r})=>t("div",{style:{position:"relative",height:i+36}},t("div",{className:"resource-header",style:{height:i+36}},r({group:e}))),p=({children:e,maxHeight:i,viewSize:{width:r}})=>t("div",{className:"timeline-separator",style:{height:i+36,overflow:"hidden",width:r}},e),u=({group:{title:e}})=>t("div",null,e),g=e=>t("div",null,n(e.start,"yyyy-MM-dd HH")),v=(e,t)=>e&&t&&e&&t[e]?t[e]:{title:e||""},y=({groups:e,events:n,startDate:y=c(new Date),endDate:x=d(c(new Date),40),width:b=5e3,interval:D=432e5,resourceHeaderWidth:k=200,groupKey:T,getGroupData:H=v,resourceNode:N=u,itemNode:j=m,dateNode:O=g,onEventClick:S=(e=>{})})=>{const z=y.getTime(),M=x.getTime()-z,C={startDate:y,startTime:z,endDate:x,totalTicks:M,ratio:b/M,width:b},G=s(null),W=s(null),E=e=>r(e,C),F=(I=e=>T?e[T]:"single",n.reduce((e,t)=>{const i=I(t);return Object.assign(Object.assign({},e),{[i]:[...e[i]||[],t]})},{}));var I;const q=(({start:e,end:t,interval:i})=>{const r=[],s=e.getTime(),a=t.getTime(),n=Math.ceil((a-s)/i);for(var l=0;l<n;l++)r.push({start:new Date(s+i*l),end:new Date(s+i*(l+1))});return r})({start:y,end:x,interval:D}),K=q.map(e=>((e,i,r)=>{const{width:s,left:a}=r(i);let n="is-future";switch(!0){default:n="is-future";break;case l(i.start):n="is-today";break;case o(i.start):n="is-past"}return t("div",{key:"datenode-"+i.start.getTime(),style:{width:s+"px",position:"absolute",left:a+"px",top:0},className:"react-scrollable-timeline-date "+n},e(i))})(O,e,E)),L=((e,t)=>{let i=[];return Object.keys(e).map(r=>{i.push(Object.assign(Object.assign({},t(e[r],r)),{key:r}))}),i})(F,e=>e.sort(i).reduce(((e,i,r)=>({rendered:s=[],maxHeight:a=0,elements:n=[]},l)=>{const o=((e,t)=>t.filter(t=>t.id!=e.id).filter(t=>{return r=e,!((i=t).end<=r.start||i.start>=r.end);var i,r}))(l,s);let d=o.length;for(var c=0;c<s.length+1;c++)if(!o.some(e=>e.positionFromTop==c)){d=c;break}const m=36*d;return{elements:[...n,t("div",{key:l.id,className:"timeline-event-wrapper "+(r?"pointer":""),style:Object.assign(Object.assign({},i(l)),{height:36,top:m}),onClick:()=>r(l)},t(e,{evt:l}))],maxHeight:Math.max(a||0,m),rendered:[...s,Object.assign(Object.assign({},l),{positionFromTop:d})]}})(j,E,S),{})),P=L.map(({maxHeight:i,key:r})=>t(h,{key:"resource-"+r,group:H(r,e),resourceNode:N,maxHeight:i})),R=L.map(({elements:e,maxHeight:i,key:r})=>t(p,{key:"group-"+r,maxHeight:i,children:e,viewSize:C}));return a(()=>{if(G&&G.current){const e=G.current.children[0].clientHeight;G.current.style.height=e+"px",W&&W.current&&(W.current.style.marginTop=e-1+"px")}},[]),t("div",{className:"react-scrollable-timeline",style:{maxWidth:"100%",position:"relative",display:"flex",flexDirection:"row",border:"1px solid #DDD"}},T&&t("div",{ref:W,style:{width:k+"px",position:"relative",flexGrow:0,flexShrink:0}},P),t("div",{style:{overflowX:"scroll",maxWidth:"100%",position:"relative",flexGrow:1}},t(f,{dates:q,lineItem:w,viewSize:C}),t("div",{ref:G,style:{width:C.width,position:"relative",height:"5rem"}},K),R))},f=({dates:e,lineItem:i,viewSize:r})=>t("div",{style:{display:"flex",justifyContent:"space-between"}},e.map(e=>i({date:e,viewSize:r}))),w=({date:e,viewSize:i})=>{const{width:s,left:a}=r(e,i);return t("div",{key:"line-"+e.start.getTime(),style:{width:s+"px",display:"inline-flex",position:"absolute",left:a+"px",height:"100%",borderLeft:"1px solid #DDD",top:0}})};export{y as Timeline};
