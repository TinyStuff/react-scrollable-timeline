import*as e from"react";import{createElement as t}from"react";import{startOfDay as i,addDays as r,format as s,isPast as a,isToday as n}from"date-fns";const o=(e,t)=>e.start.getTime()-t.start.getTime(),l=(e,{startTime:t,ratio:i})=>{const r=e.start.getTime()-t,s=e.end.getTime()-t,a=Math.round(r*i);return{width:Math.round(s*i)-a,left:a}},{useRef:d,useEffect:c}=e,m=({evt:e})=>t("div",{key:e.id,className:"timeline-event"},e.title?e.title:e.id),h=({group:e,maxHeight:i,resourceNode:r})=>t("div",{style:{position:"relative",height:i+36}},t("div",{className:"resource-header",style:{height:i+36}},r({group:e}))),p=({children:e,maxHeight:i,viewSize:{width:r}})=>t("div",{className:"timeline-separator",style:{height:i+36,overflow:"hidden",width:r}},e),u=({group:{title:e}})=>t("div",null,e),g=e=>t("div",null,s(e.start,"yyyy-MM-dd HH")),v=(e,t)=>t&&e&&t[e]?t[e]:{title:e},f=({groups:e,events:s,startDate:f=i(new Date),endDate:x=r(i(new Date),40),width:b=5e3,interval:k=432e5,resourceHeaderWidth:D=200,groupKey:T,getGroupData:H=v,resourceNode:N=u,itemNode:j=m,dateNode:O=g,onEventClick:S=(e=>{})})=>{const z=f.getTime(),M=x.getTime()-z,C={startDate:f,startTime:z,endDate:x,totalTicks:M,ratio:b/M,width:b},G=d(null),W=d(null),E=e=>l(e,C),F=(I=e=>T?e[T]:"single",s.reduce((e,t)=>{const i=I(t);return Object.assign(Object.assign({},e),{[i]:[...e[i]||[],t]})},{}));var I;const K=(({start:e,end:t,interval:i})=>{const r=[],s=e.getTime(),a=t.getTime(),n=Math.ceil((a-s)/i);for(var o=0;o<n;o++)r.push({start:new Date(s+i*o),end:new Date(s+i*(o+1))});return r})({start:f,end:x,interval:k}),L=K.map(e=>((e,i,r)=>{const{width:s,left:o}=r(i);let l="is-future";switch(!0){default:l="is-future";break;case n(i.start):l="is-today";break;case a(i.start):l="is-past"}return t("div",{style:{width:s+"px",position:"absolute",left:o+"px",top:0},className:"timeline-date "+l},e(i))})(O,e,E)),R=((e,t)=>{let i=[];return Object.keys(e).map(r=>{i.push(Object.assign(Object.assign({},t(e[r],r)),{key:r}))}),i})(F,e=>e.sort(o).reduce(((e,i,r)=>({rendered:s=[],maxHeight:a=0,elements:n=[]},o)=>{const l=((e,t)=>t.filter(t=>t.id!=e.id).filter(t=>{return r=e,!((i=t).end<=r.start||i.start>=r.end);var i,r}))(o,s);let d=l.length;for(var c=0;c<s.length+1;c++)if(!l.some(e=>e.positionFromTop==c)){d=c;break}const m=36*d;return{elements:[...n,t("div",{key:o.id,className:"timeline-event-wrapper "+(r?"pointer":""),style:Object.assign(Object.assign({},i(o)),{height:36,top:m}),onClick:()=>r(o)},t(e,{evt:o}))],maxHeight:Math.max(a||0,m),rendered:[...s,Object.assign(Object.assign({},o),{positionFromTop:d})]}})(j,E,S),{})),X=R.map(({maxHeight:i,key:r})=>t(h,{key:"resource-"+r,group:H(r,e),resourceNode:N,maxHeight:i})),q=R.map(({elements:e,maxHeight:i,key:r})=>t(p,{key:"group-"+r,maxHeight:i,children:e,viewSize:C}));return c(()=>{if(G&&G.current){const e=G.current.children[0].clientHeight;G.current.style.height=e+"px",W&&W.current&&(W.current.style.marginTop=e-1+"px")}},[]),t("div",{className:"timeline",style:{maxWidth:"100%",position:"relative",display:"flex",flexDirection:"row",border:"1px solid #DDD"}},T&&t("div",{ref:W,style:{width:D+"px",position:"relative",flexGrow:0,flexShrink:0}},X),t("div",{style:{overflowX:"scroll",maxWidth:"100%",position:"relative",flexGrow:1}},t(y,{dates:K,lineItem:w,viewSize:C}),t("div",{ref:G,style:{width:C.width,position:"relative",height:"5rem"}},L),q))},y=({dates:e,lineItem:i,viewSize:r})=>t("div",{style:{display:"flex",justifyContent:"space-between"}},e.map(e=>i({date:e,viewSize:r}))),w=({date:e,viewSize:i})=>{const{width:r,left:s}=l(e,i);return t("div",{key:e.start.getTime(),style:{width:r+"px",display:"inline-flex",position:"absolute",left:s+"px",height:"100%",borderLeft:"1px solid #DDD",top:0}})};export{f as Timeline};
