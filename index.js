"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("date-fns");const i=(e,t)=>e.start.getTime()-t.start.getTime(),r=(e,{startTime:t,ratio:i})=>{const r=e.start.getTime()-t,a=e.end.getTime()-t,s=Math.round(r*i);return{width:Math.round(a*i)-s,left:s}},{useRef:a,useEffect:s}=e,n=({evt:t})=>e.createElement("div",{key:t.id,className:"timeline-event"},t.title?t.title:t.id),l=({group:t,maxHeight:i,resourceNode:r})=>e.createElement("div",{style:{position:"relative",height:i+36}},e.createElement("div",{className:"resource-header",style:{height:i+36}},r({group:t}))),o=({children:t,maxHeight:i,viewSize:{width:r}})=>e.createElement("div",{className:"timeline-separator",style:{height:i+36,overflow:"hidden",width:r}},t),d=({group:{title:t}})=>e.createElement("div",null,t),c=i=>e.createElement("div",null,t.format(i.start,"yyyy-MM-dd HH")),m=(e,t)=>t&&e&&t[e]?t[e]:{title:e},h=({dates:t,lineItem:i,viewSize:r})=>e.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t.map(e=>i({date:e,viewSize:r}))),u=({date:t,viewSize:i})=>{const{width:a,left:s}=r(t,i);return e.createElement("div",{key:t.start.getTime(),style:{width:a+"px",display:"inline-flex",position:"absolute",left:s+"px",height:"100%",borderLeft:"1px solid #DDD",top:0}})};exports.Timeline=({groups:p,events:g,startDate:v=t.startOfDay(new Date),endDate:y=t.addDays(t.startOfDay(new Date),40),width:f=5e3,interval:w=432e5,resourceHeaderWidth:x=200,groupKey:E,getGroupData:D=m,resourceNode:b=d,itemNode:T=n,dateNode:k=c,onEventClick:H=(e=>{})})=>{const O=v.getTime(),j=y.getTime()-O,N={startDate:v,startTime:O,endDate:y,totalTicks:j,ratio:f/j,width:f},M=a(null),S=a(null),z=e=>r(e,N),C=(G=e=>E?e[E]:"single",g.reduce((e,t)=>{const i=G(t);return Object.assign(Object.assign({},e),{[i]:[...e[i]||[],t]})},{}));var G;const W=(({start:e,end:t,interval:i})=>{const r=[],a=e.getTime(),s=t.getTime(),n=Math.ceil((s-a)/i);for(var l=0;l<n;l++)r.push({start:new Date(a+i*l),end:new Date(a+i*(l+1))});return r})({start:v,end:y,interval:w}),q=W.map(i=>((i,r,a)=>{const{width:s,left:n}=a(r);let l="is-future";switch(!0){default:l="is-future";break;case t.isToday(r.start):l="is-today";break;case t.isPast(r.start):l="is-past"}return e.createElement("div",{style:{width:s+"px",position:"absolute",left:n+"px",top:0},className:"timeline-date "+l},i(r))})(k,i,z)),F=((e,t)=>{let i=[];return Object.keys(e).map(r=>{i.push(Object.assign(Object.assign({},t(e[r],r)),{key:r}))}),i})(C,t=>t.sort(i).reduce(((t,i,r)=>({rendered:a=[],maxHeight:s=0,elements:n=[]},l)=>{const o=((e,t)=>t.filter(t=>t.id!=e.id).filter(t=>{return r=e,!((i=t).end<=r.start||i.start>=r.end);var i,r}))(l,a);let d=o.length;for(var c=0;c<a.length+1;c++)if(!o.some(e=>e.positionFromTop==c)){d=c;break}const m=36*d;return{elements:[...n,e.createElement("div",{key:l.id,className:"timeline-event-wrapper "+(r?"pointer":""),style:Object.assign(Object.assign({},i(l)),{height:36,top:m}),onClick:()=>r(l)},e.createElement(t,{evt:l}))],maxHeight:Math.max(s||0,m),rendered:[...a,Object.assign(Object.assign({},l),{positionFromTop:d})]}})(T,z,H),{})),I=F.map(({maxHeight:t,key:i})=>e.createElement(l,{key:"resource-"+i,group:D(i,p),resourceNode:b,maxHeight:t})),P=F.map(({elements:t,maxHeight:i,key:r})=>e.createElement(o,{key:"group-"+r,maxHeight:i,children:t,viewSize:N}));return s(()=>{if(M&&M.current){const e=M.current.children[0].clientHeight;M.current.style.height=e+"px",S&&S.current&&(S.current.style.marginTop=e-1+"px")}},[]),e.createElement("div",{className:"timeline",style:{maxWidth:"100%",position:"relative",display:"flex",flexDirection:"row",border:"1px solid #DDD"}},E&&e.createElement("div",{ref:S,style:{width:x+"px",position:"relative",flexGrow:0,flexShrink:0}},I),e.createElement("div",{style:{overflowX:"scroll",maxWidth:"100%",position:"relative",flexGrow:1}},e.createElement(h,{dates:W,lineItem:u,viewSize:N}),e.createElement("div",{ref:M,style:{width:N.width,position:"relative",height:"5rem"}},q),P))};
