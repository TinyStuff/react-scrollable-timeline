"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("date-fns"),r=function(){return(r=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function i(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,l=o.length;a<l;a++,n++)i[n]=o[a];return i}var n=e.useRef,o=e.useEffect,a=function(e,t){return e.start-t.start},l=function(e,t){var r=t.startDate,i=t.ratio,n=e.start.getTime()-r.getTime(),o=e.end.getTime()-r.getTime(),a=Math.round(n*i);return{width:Math.round(o*i)-a,left:a}},d=function(t){var r=t.evt;return e.createElement("div",{key:r.id,style:{backgroundColor:"blue",color:"#fff",border:"solid 2px red"}},r.id)},u=function(t){var r=t.group,i=t.maxHeight,n=t.resourceNode;return e.createElement("div",{style:{position:"relative",height:i+36}},e.createElement("div",{style:{overflow:"hidden",display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"flex-start",height:i+36,width:"100%",borderTop:"1px solid rgb(221, 221, 221)"}},n({group:r})))},s=function(t){var r=t.children,i=t.maxHeight,n=t.viewSize.width;return e.createElement("div",{style:{position:"relative",height:i+36,width:n,borderBottom:"1px solid rgb(221, 221, 221)"}},r)},c=function(t){var r=t.group.title;return e.createElement("div",null,r)},f=function(r){return e.createElement("div",null,t.format(r,"yyyy-MM-dd"))},v=function(e,t){var r=[];return Object.keys(e).map((function(i){r[i]=t(e[i],i)})),r},h=function(e,t){return t[e]||e},m=function(t){var r=t.dates,i=t.lineItem,n=t.viewSize;return e.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.map((function(e){return i({date:e,viewSize:n})})))},p=function(r){var i=r.date,n=r.viewSize,o=l({start:i,end:t.addDays(i,1)},n),a=o.width,d=o.left;return e.createElement("div",{style:{width:a+"px",display:"inline-flex",position:"absolute",left:d+"px",height:"100%",borderLeft:"1px solid #DDD",top:0}})};exports.Timeline=function(y){var g,x=y.groups,w=y.events,D=y.startDate,b=void 0===D?t.subDays(t.startOfDay(new Date),2):D,E=y.endDate,k=void 0===E?t.addDays(t.startOfDay(new Date),60):E,T=y.width,H=void 0===T?5e3:T,O=y.resourceHeaderWidth,S=void 0===O?200:O,N=y.groupKey,j=void 0===N?"articleId":N,z=y.getGroupData,M=void 0===z?h:z,C=y.resourceNode,I=void 0===C?c:C,G=y.itemNode,P=void 0===G?d:G,W=y.dateNode,q=void 0===W?f:W,F=y.onEventClick,_=void 0===F?function(e){}:F,A=k.getTime()-b.getTime(),B={startDate:b,endDate:k,totalTicks:A,ratio:H/A,width:H},K=n(null),L=n(null),R=function(e){return l(e,B)},J=(g=function(e){return e[j]},w.reduce((function(e,t){var n,o=g(t);return r(r({},e),((n={})[o]=i(e[o]||[],[t]),n))}),{})),Q=t.eachDayOfInterval({start:b,end:k}),U=Q.map((function(r){return function(r,i,n){var o=l({start:i,end:t.addDays(i,1)},n),a=o.width,d=o.left,u="is-future";switch(!0){default:u="is-future";break;case t.isToday(i):u="is-today";break;case t.isPast(i):u="is-past"}return e.createElement("div",{style:{width:a+"px",position:"absolute",left:d+"px",top:0},className:"timeline-date "+u},r(i))}(q,r,B)})),V=v(J,(function(t){return t.sort(a).reduce(function(t,n,o){return function(a,l){for(var d=a.rendered,u=void 0===d?[]:d,s=a.maxHeight,c=void 0===s?0:s,f=a.elements,v=void 0===f?[]:f,h=function(e,t){return t.filter((function(t){return t.id!=e.id})).filter((function(t){return i=e,!((r=t).end<=i.start||r.start>=i.end);var r,i}))}(l,u),m=h.length,p=0;p<u.length+1;p++)if(!h.some((function(e){return e.positionFromTop==p}))){m=p;break}var y=36*m;return{elements:i(v,[e.createElement("div",{key:l.id,style:r(r({},n(l)),{height:36,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",top:y,position:"absolute",cursor:o?"pointer":"default"}),onClick:function(){return o(l)}},e.createElement(t,{evt:l}))]),maxHeight:Math.max(c||0,y),rendered:i(u,[r(r({},l),{positionFromTop:m})])}}}(P,R,_),{})})),X=v(V,(function(t,r){var i=t.maxHeight;return e.createElement(u,{key:r,group:M(r,x),resourceNode:I,maxHeight:i})})),Y=v(V,(function(t,r){var i=t.elements,n=t.maxHeight;return e.createElement(s,{key:r,maxHeight:n,children:i,viewSize:B})}));return o((function(){if(K&&K.current){var e=K.current.children[0].clientHeight;K.current.style.height=e+"px",L&&L.current&&(L.current.style.marginTop=e-1+"px")}}),[]),e.createElement("div",{className:"timeline",style:{maxWidth:"100%",position:"relative",display:"flex",flexDirection:"row",border:"1px solid #DDD"}},e.createElement("div",{ref:L,style:{width:S+"px",position:"relative",flexGrow:0,flexShrink:0}},X),e.createElement("div",{style:{overflow:"scroll",maxWidth:"100%",position:"relative",flexGrow:1}},e.createElement(m,{dates:Q,lineItem:p,viewSize:B}),e.createElement("div",{ref:K,style:{width:B.width,position:"relative",height:"5rem"}},U),Y))};
