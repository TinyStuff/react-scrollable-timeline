"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");const t=(e,t)=>e.start.getTime()-t.start.getTime(),i=(e,{startTime:t,ratio:i})=>{const r=e.start.getTime()-t,a=e.end.getTime()-t,s=Math.round(r*i);return{width:Math.round(a*i)-s,left:s}},{useRef:r,useEffect:a}=e,{format:s,isToday:n,isPast:l,addDays:o,startOfDay:d}=require("date-fns"),c=({evt:t})=>e.createElement("div",{key:t.id,className:"timeline-event"},t.title?t.title:t.id),m=({group:t,maxHeight:i,resourceNode:r})=>e.createElement("div",{style:{position:"relative",height:i+36}},e.createElement("div",{className:"resource-header",style:{height:i+36}},r({group:t}))),h=({children:t,maxHeight:i,viewSize:{width:r}})=>e.createElement("div",{className:"timeline-separator",style:{height:i+36,overflow:"hidden",width:r}},t),u=({group:{title:t}})=>e.createElement("div",null,t),p=t=>e.createElement("div",null,s(t.start,"yyyy-MM-dd HH")),g=(e,t)=>e&&t&&e&&t[e]?t[e]:{title:e||""},v=({dates:t,lineItem:i,viewSize:r})=>e.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},t.map(e=>i({date:e,viewSize:r}))),y=({date:t,viewSize:r})=>{const{width:a,left:s}=i(t,r);return e.createElement("div",{key:"line-"+t.start.getTime(),style:{width:a+"px",display:"inline-flex",position:"absolute",left:s+"px",height:"100%",borderLeft:"1px solid #DDD",top:0}})};exports.Timeline=({groups:s,events:f,startDate:w=d(new Date),endDate:x=o(d(new Date),40),width:E=5e3,interval:b=432e5,resourceHeaderWidth:D=200,groupKey:T,getGroupData:k=g,resourceNode:H=u,itemNode:j=c,dateNode:N=p,onEventClick:O=(e=>{})})=>{const M=w.getTime(),S=x.getTime()-M,z={startDate:w,startTime:M,endDate:x,totalTicks:S,ratio:E/S,width:E},C=r(null),G=r(null),W=e=>i(e,z),q=(F=e=>T?e[T]:"single",f.reduce((e,t)=>{const i=F(t);return Object.assign(Object.assign({},e),{[i]:[...e[i]||[],t]})},{}));var F;const I=(({start:e,end:t,interval:i})=>{const r=[],a=e.getTime(),s=t.getTime(),n=Math.ceil((s-a)/i);for(var l=0;l<n;l++)r.push({start:new Date(a+i*l),end:new Date(a+i*(l+1))});return r})({start:w,end:x,interval:b}),P=I.map(t=>((t,i,r)=>{const{width:a,left:s}=r(i);let o="is-future";switch(!0){default:o="is-future";break;case n(i.start):o="is-today";break;case l(i.start):o="is-past"}return e.createElement("div",{key:"datenode-"+i.start.getTime(),style:{width:a+"px",position:"absolute",left:s+"px",top:0},className:"timeline-date "+o},t(i))})(N,t,W)),_=((e,t)=>{let i=[];return Object.keys(e).map(r=>{i.push(Object.assign(Object.assign({},t(e[r],r)),{key:r}))}),i})(q,i=>i.sort(t).reduce(((t,i,r)=>({rendered:a=[],maxHeight:s=0,elements:n=[]},l)=>{const o=((e,t)=>t.filter(t=>t.id!=e.id).filter(t=>{return r=e,!((i=t).end<=r.start||i.start>=r.end);var i,r}))(l,a);let d=o.length;for(var c=0;c<a.length+1;c++)if(!o.some(e=>e.positionFromTop==c)){d=c;break}const m=36*d;return{elements:[...n,e.createElement("div",{key:l.id,className:"timeline-event-wrapper "+(r?"pointer":""),style:Object.assign(Object.assign({},i(l)),{height:36,top:m}),onClick:()=>r(l)},e.createElement(t,{evt:l}))],maxHeight:Math.max(s||0,m),rendered:[...a,Object.assign(Object.assign({},l),{positionFromTop:d})]}})(j,W,O),{})),K=_.map(({maxHeight:t,key:i})=>e.createElement(m,{key:"resource-"+i,group:k(i,s),resourceNode:H,maxHeight:t})),L=_.map(({elements:t,maxHeight:i,key:r})=>e.createElement(h,{key:"group-"+r,maxHeight:i,children:t,viewSize:z}));return a(()=>{if(C&&C.current){const e=C.current.children[0].clientHeight;C.current.style.height=e+"px",G&&G.current&&(G.current.style.marginTop=e-1+"px")}},[]),e.createElement("div",{className:"timeline",style:{maxWidth:"100%",position:"relative",display:"flex",flexDirection:"row",border:"1px solid #DDD"}},T&&e.createElement("div",{ref:G,style:{width:D+"px",position:"relative",flexGrow:0,flexShrink:0}},K),e.createElement("div",{style:{overflowX:"scroll",maxWidth:"100%",position:"relative",flexGrow:1}},e.createElement(v,{dates:I,lineItem:y,viewSize:z}),e.createElement("div",{ref:C,style:{width:z.width,position:"relative",height:"5rem"}},P),L))};
